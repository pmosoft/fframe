<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.pmosoft.fframe.dams.table.TableDao">


<!--******************************************************** 
**
**                      MetaTablColInfo
**
*********************************************************-->

<select id="selectMetaTabColInfoList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    -- TableDao.selectMetaTabColInfoList
    SELECT 
           '추출'               AS STS_NM
           ,'MARIADB'          AS DB_NM
           ,A.TABLE_SCHEMA     AS OWNER
           ,A.TABLE_NAME       AS TAB_NM
           ,A.ORDINAL_POSITION AS COL_ID
           ,A.COLUMN_NAME      AS COL_NM
           ,A.COLUMN_COMMENT   AS COL_HNM
           ,' '                AS COL_DESC
           ,A.DATA_TYPE        AS DATA_TYPE_NM
           ,CASE WHEN A.DATA_TYPE IN ('CHAR','VARCHAR') THEN A.CHARACTER_MAXIMUM_LENGTH
                 WHEN A.DATA_TYPE IN ('INT','NUMERIC') THEN A.NUMERIC_PRECISION
            END                AS LEN
           ,A.NUMERIC_SCALE    AS DECIMAL_CNT 
           ,A.COLUMN_TYPE      AS DATA_TYPE_DESC
           ,DATE_FORMAT(NOW(),'%Y%m%d%H%i') AS REG_DTM
           ,''                 AS REG_USR_ID
           ,DATE_FORMAT(NOW(),'%Y%m%d%H%i') AS UPD_DTM
           ,''                 AS UPD_USR_ID
    FROM   INFORMATION_SCHEMA.COLUMNS A 
    WHERE  1=1
    AND    TABLE_NAME LIKE 'TD%'
    AND    COLUMN_NAME LIKE '%'
    ORDER BY A.TABLE_NAME,A.ORDINAL_POSITION    
</select>


<!--******************************************************** 
**
**                        TablColInfo
**
*********************************************************-->

<select id="selectTabColInfoList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    -- TableDao.selectTabColInfoList
    SELECT   DB_NM
            ,OWNER
            ,TAB_NM
            ,COL_NM
            ,COL_HNM
            ,COL_DESC
            ,DATA_TYPE_NM
            ,LEN
            ,DECIMAL_CNT
            ,DATA_TYPE_DESC
            ,date_format(REG_DTM,'%Y.%m.%d %H:%i:%S') AS REG_DTM
            ,REG_USR_ID
            ,date_format(UPD_DTM,'%Y.%m.%d %H:%i:%S') AS UPD_DTM
            ,UPD_USR_ID
    FROM    TDACM00080
    ORDER BY DB_NM,OWNER,TAB_NM,COL_NM
</select>

<select id="selectTabColInfoCnt" parameterType="java.util.HashMap" resultType="int">
    -- TableDao.selectTabColInfoCnt
    SELECT COUNT(*) CNT
    FROM   TDACM00010
    WHERE  PKG_FUL_NM = #{PKG_FUL_NM}
</select>

<insert id="insertTabColInfo" parameterType="java.util.HashMap">

    -- TableDao.insertTabColInfo
    INSERT INTO TDACM00010
    (
         PKG_FUL_NM
        ,PKG2_NM
        ,PKG3_NM
        ,PKG4_NM
        ,PKG_HNM
        ,PKG_DESC
        ,USE_YN
        ,REG_DTM
        ,REG_USR_ID
        ,UPD_DTM
        ,UPD_USR_ID
    ) VALUES (
         #{PKG_FUL_NM}
        ,#{PKG2_NM}
        ,#{PKG3_NM}
        ,#{PKG4_NM}
        ,#{PKG_HNM}
        ,#{PKG_DESC}
        ,CASE WHEN #{USE_YN} = 'true' THEN 'Y' ELSE 'N' END
        ,curdate()
        ,#{REG_USR_ID}
        ,curdate()
        ,#{UPD_USR_ID}
    )

</insert>


<delete id="deleteTabColInfo" parameterType="java.util.HashMap">
    -- TableDao.deleteTabColInfo
    DELETE FROM TDACM00010 WHERE PKG_FUL_NM = #{PKG_FUL_NM}
</delete>

<update id="updateTabColInfo" parameterType="java.util.HashMap">

    -- TableDao.updateTabColInfo
    UPDATE TDACM00010
    SET  PKG2_NM      = #{PKG2_NM}
        ,PKG3_NM      = #{PKG3_NM}
        ,PKG4_NM      = #{PKG4_NM}
        ,PKG_HNM      = #{PKG_HNM}
        ,PKG_DESC     = #{PKG_DESC}
        ,USE_YN       = CASE WHEN #{USE_YN} = 'true' THEN 'Y' ELSE 'N' END
        ,UPD_DTM      = curdate()
        ,UPD_USR_ID  = #{UPD_USR_ID}
    WHERE  PKG_FUL_NM = #{PKG_FUL_NM}

</update>


<!-- 

                              TableInfo

 -->

<select id="selectTabInfoList" parameterType="java.util.HashMap" resultType="java.util.HashMap">

	-- TableDao.selectTabInfoList
	SELECT   PKG_FUL_NM
			,PKG2_NM
			,PKG3_NM
			,PKG4_NM
			,PKG_HNM
			,PKG_DESC
			,USE_YN
			,date_format(REG_DTM,'%Y.%m.%d %H:%i:%S') AS REG_DTM
			,REG_USR_ID
			,date_format(UPD_DTM,'%Y.%m.%d %H:%i:%S') AS UPD_DTM
			,UPD_USR_ID
	FROM    TDACM00010
    WHERE   PKG2_NM LIKE CONCAT(CONCAT('%',#{searchValue}),'%')
    OR      PKG3_NM LIKE CONCAT(CONCAT('%',#{searchValue}),'%')
    OR      PKG4_NM LIKE CONCAT(CONCAT('%',#{searchValue}),'%')
    OR      PKG_FUL_NM LIKE CONCAT(CONCAT('%',#{searchValue}),'%')
    OR      PKG_HNM LIKE CONCAT(CONCAT('%',#{searchValue}),'%')
    OR      PKG_DESC LIKE CONCAT(CONCAT('%',#{searchValue}),'%')
	ORDER BY PKG_FUL_NM
</select>

<select id="selectTabInfoCnt" parameterType="java.util.HashMap" resultType="int">
	-- TableDao.selectTabInfoCnt
	SELECT COUNT(*) CNT
	FROM   TDACM00010
    WHERE  PKG_FUL_NM = #{PKG_FUL_NM}
</select>

<insert id="insertTabInfo" parameterType="java.util.HashMap">

	-- TableDao.insertTabInfo
	INSERT INTO TDACM00010
	(
	     PKG_FUL_NM
		,PKG2_NM
		,PKG3_NM
		,PKG4_NM
		,PKG_HNM
		,PKG_DESC
		,USE_YN
		,REG_DTM
		,REG_USR_ID
		,UPD_DTM
		,UPD_USR_ID
	) VALUES (
         #{PKG_FUL_NM}
		,#{PKG2_NM}
		,#{PKG3_NM}
		,#{PKG4_NM}
		,#{PKG_HNM}
		,#{PKG_DESC}
		,CASE WHEN #{USE_YN} = 'true' THEN 'Y' ELSE 'N' END
		,curdate()
		,#{REG_USR_ID}
		,curdate()
		,#{UPD_USR_ID}
	)

</insert>


<delete id="deleteTabInfo" parameterType="java.util.HashMap">
	-- TableDao.deleteTabInfo
	DELETE FROM TDACM00010 WHERE PKG_FUL_NM = #{PKG_FUL_NM}
</delete>

<update id="updateTabInfo" parameterType="java.util.HashMap">

	-- TableDao.updateTabInfo
	UPDATE TDACM00010
	SET  PKG2_NM      = #{PKG2_NM}
		,PKG3_NM      = #{PKG3_NM}
		,PKG4_NM      = #{PKG4_NM}
		,PKG_HNM      = #{PKG_HNM}
		,PKG_DESC     = #{PKG_DESC}
		,USE_YN       = CASE WHEN #{USE_YN} = 'true' THEN 'Y' ELSE 'N' END
		,UPD_DTM      = curdate()
		,UPD_USR_ID  = #{UPD_USR_ID}
	WHERE  PKG_FUL_NM = #{PKG_FUL_NM}

</update>


</mapper>
